<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script src="./envelopes.js"></script>
<style>
    .button:hover {
        filter: brightness(90%);
    }
    .button:active {
        filter: brightness(80%);
    }
</style>
</head>
<body>
    <table style="font-family: Arial, Helvetica, sans-serif; font-size: 10pt;">
        <tr style="vertical-align: top;">
            <td id="img-panel" style="height:auto;">
                <svg id="envelope" style="position:absolute; z-index:1; display:none;"></svg>
                <div id="crop" style="overflow:hidden;">
                    <img id="image" style="height:auto;"/>
                </div>
            </td>
            <td>&nbsp;</td>
            <td>
                <input type="file" accept=".jpg, .png" onchange="loadImage(this.files[0]);"/><br/>

                <div id="rotate-controls" style="display:none;">
                    <table style="border:0; text-align:center;user-select:none;">
                        <tr>
                            <td>
                                <svg button_id="rotateleft90" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">ROTATE 90Â°</td>
                            <td>
                                <svg button_id="rotateright90" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <button onclick="submitRotate()">OK</button>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="dimensions" style="display:none;">
                    <br/>Width:&nbsp;<span id="env-width"></span>"&nbsp;&nbsp;Height:<span id="env-height"></span>" 
                </div>

                <div id="crop-controls" style="display:none;">
                    <br/><b>Crop:</b><br/>
                    <table style="border:0; text-align:center;user-select:none;">
                        <tr>
                            <td colspan="3">
                                <svg button_id="cropdecY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <svg button_id="cropdecX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">TOP LEFT</td>
                            <td>
                                <svg button_id="cropincX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <svg button_id="cropincY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr style="height:12px;"></tr>
                        <tr>
                            <td colspan="3">
                                <svg button_id="cropdecDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <svg button_id="cropdecDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">BOTTOM RIGHT</td>
                            <td>
                                <svg button_id="cropincDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <svg button_id="cropincDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr style="height:12px;"></tr>
                        <tr>
                            <td>
                                <svg button_id="cropdecR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">ROTATE</td>
                            <td>
                                <svg button_id="cropincR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <button onclick="submitCrop()">OK</button>
                            </td>
                        </tr>
                    </table>
                </div>

                <div id="window-controls" style="display:none;">
                    <br/>Window 1<br/>
                    <table style="border:0; text-align:center;user-select:none;">
                        <tr>
                            <td colspan="3">
                            <svg button_id="win1decY" width="24" height="24" class="button">
                                <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                            </svg>
                            </td>
                            <td style="width:6px;" rowspan="3"></td>
                            <td colspan="3">
                                <svg button_id="win1decDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                            <td style="width:6px;" rowspan="3"></td>
                            <td>
                                <svg button_id="win1incR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <svg button_id="win1decX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">POS</td>
                            <td>
                                <svg button_id="win1incX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                            <td>
                                <svg button_id="win1decDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">SIZE</td>
                            <td>
                                <svg button_id="win1incDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">ROUND</td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <svg button_id="win1incY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                            <td colspan="3">
                                <svg button_id="win1incDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                            <td>
                                <svg button_id="win1decR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                        </tr>
                    </table>

                    <br/><br/>Window 2&nbsp;&nbsp;<input type="checkbox" id="window2" onchange="controls2()"><br/>
                    <table id="window-2-controls" style="border:0; text-align:center;user-select:none;display:none;">
                        <tr>
                            <td colspan="3">
                            <svg button_id="win2decY" width="24" height="24" class="button">
                                <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                            </svg>
                            </td>
                            <td style="width6px;" rowspan="3"></td>
                            <td colspan="3">
                                <svg button_id="win2decDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                            <td style="width:6px;" rowspan="3"></td>
                            <td>
                                <svg button_id="win2incR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 3 l9 18 l-9 -9 l-9 9 l9 -18"/>
                                </svg>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <svg button_id="win2decX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">POS</td>
                            <td>
                                <svg button_id="win2incX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                            <td>
                                <svg button_id="win2decDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M3 12 l18 9 l-9 -9 l9 -9 l-18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">SIZE</td>
                            <td>
                                <svg button_id="win2incDX" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M21 12 l-18 9 l9 -9 l-9 -9 l18 9"/>
                                </svg>
                            </td>
                            <td style="width:25px; font-size:9px;">ROUND</td>
                        </tr>
                        <tr>
                            <td colspan="3">
                                <svg button_id="win2incY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                            <td colspan="3">
                                <svg button_id="win2incDY" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                            <td>
                                <svg button_id="win2decR" width="24" height="24" class="button">
                                    <path fill="whitesmoke" stroke="black" d="M0 0 v24 h24 v-24 h-24"/>
                                    <path fill="black" stroke="transparent" d="M12 21 l-9 -18 l9 9 l9 -9 l-9 18"/>
                                </svg>
                            </td>
                        </tr>
                    </table>
                    <br/><br/>Code<br/>
                    <textarea id="img-text" style="width:200px; height:400px;"></textarea>
                </div>
            </td>
        </tr>
    </table>

<script>
    var oDX = 0, oDY = 0, cropR = 0;
    var cropX1 = 0, cropY1 = 0, cropX2 = 0, cropY2 = 0;
    var idx, idy, scale, edx, edy;
    var posx = 128, posy = 294, dx = 665, dy = 220, round = 50;
    var posx2 = 128, posy2 = 63, dx2 = 477, dy2 = 156, round2 = 33;
    var roundQ = 0.55;
    var window2 = false;
    var eWidth, eHeight;


    const crop = document.getElementById("crop");
    const img = document.getElementById("image");
    const imgPanel = document.getElementById("img-panel");
    const rotateControls = document.getElementById('rotate-controls');
    const cropControls = document.getElementById('crop-controls');
    const dimensions = document.getElementById('dimensions');
    const envWidth = document.getElementById('env-width');
    const envHeight = document.getElementById('env-height');
    const windowControls = document.getElementById("window-controls");
    const window2Controls = document.getElementById("window-2-controls");
    const window2chk = document.getElementById("window2");
    const envelope = document.getElementById("envelope");
    const imgText = document.getElementById("img-text");

    imgPanel.style.width = LEFT_PANEL_WIDTH;
    imgPanel.style.minWidth = LEFT_PANEL_WIDTH;
    imgPanel.style.maxWidth = LEFT_PANEL_WIDTH;
    crop.style.width = LEFT_PANEL_WIDTH;
    envelope.style.width = LEFT_PANEL_WIDTH;
    envelope.style.height = LEFT_PANEL_WIDTH;
    
    function loadImage(f) {
        rotateControls.style.display = 'block';
        img.onload = function() { 
            oDX = cropDX = this.width; oDY = cropDY = this.height;
            cropX1 = cropY1 = cropX2 = cropY2 = cropR = 0;
            window2chk.checked = false; window2 = false;
            rotateControls.style.display = 'block';
            cropControls.style.display = 'none';
            dimensions.style.display = 'none';
            windowControls.style.display = 'none';
            window2Controls.style.display = 'none';
            envelope.style.display = 'none';
            imgdisplay();
            };
        img.src = URL.createObjectURL(f);
    }

    function imgdisplay() {
        let sin = Math.sin(cropR * Math.PI / 180);
        let cos = Math.cos(cropR * Math.PI / 180);
        let idx0 = oDX * Math.abs(cos) + oDY * Math.abs(sin);
        let idy0 = oDX * Math.abs(sin) + oDY * Math.abs(cos);
        idx = idx0 - cropX1 - cropX2;
        idy = idy0 - cropY1 - cropY2;
        scale = LEFT_PANEL_WIDTH / idx;
        crop.style.height = (idy * scale) + 'px';
        img.style.marginLeft = ((idx0/2 - cropX1)*scale - oDX/2) + 'px';
        img.style.marginTop = ((idy0/2 - cropY1)*scale - oDY/2) + 'px';
        img.style.transform = 'scale(' + scale + ') rotate(' + cropR + 'deg)';
        envHeight.innerHTML = eHeight = Math.round(idy / 3) / 100;
        envWidth.innerHTML = eWidth = Math.round(idx / 3) / 100;
        console.log('rotate(' + cropR + 'deg) scale(' + scale + ')');
    }

    function submitRotate() {
        rotateControls.style.display = 'none';
        cropControls.style.display = 'block';
        dimensions.style.display = 'block';
    }

    function submitCrop() {
        cropControls.style.display = 'none';
        windowControls.style.display = 'block';
        envelope.style.display = 'block';
        edx = LEFT_PANEL_WIDTH - 1;
        edy = Math.round(idy * scale) - 1;
        display();
    }

    function controls2() {
        window2 = !window2;
        if (window2) window2Controls.style.display = 'block';
        else window2Controls.style.display = 'none';
        display();
    }

    var buttons = document.getElementsByClassName("button");
    var buttonPressed = 0, downTime, click = false;

    var keyup = function(state) {
        buttonPressed = 'none';
    };

    var keydown = function(state) {
        buttonPressed = this.getAttribute("button_id");
        downTime = Date.now();
        click = true;
    };

    for (let i = 0; i < buttons.length; i++) {
        buttons[i].addEventListener('mousedown', keydown, false);
        buttons[i].addEventListener('mouseup', keyup, false);
        buttons[i].addEventListener('mouseout', keyup, false);
    }

    function processKeys() {
        const delay = 300;

        if (buttonPressed == 'none') return;
        if (click || Date.now() - downTime > delay) {
            click = false;
            switch (buttonPressed) {
                case 'win1decY': if (posy < 2) return; posy--; display(); break;
                case 'win1decX': if (posx < 2) return; posx--; display(); break;
                case 'win1incX': if (posx + dx > edx - 2) return; posx++; display(); break;
                case 'win1incY': if (posy + dy > edy - 2) return; posy++; display(); break;
                case 'win1decDY': if (dy <= 2 * round) return; dy--; display(); break;
                case 'win1decDX': if (dx <= 2 * round) return; dx--; display(); break;
                case 'win1incDX': if (posx + dx > edx - 2) return; dx++; display(); break;
                case 'win1incDY': if (posy + dy > edy - 2) return; dy++; display(); break;
                case 'win1incR': if (round * 2 >= dx - 1 || round * 2 >= dy - 1) return; round++; display(); break;
                case 'win1decR': if (round < 1) return; round--; display(); break;
                case 'win2decY': if (posy2 < 2) return; posy2--; display(); break;
                case 'win2decX': if (posx2 < 2) return; posx2--; display(); break;
                case 'win2incX': if (posx2 + dx2 > edx - 2) return; posx2++; display(); break;
                case 'win2incY': if (posy2 + dy2 > edy - 2) return; posy2++; display(); break;
                case 'win2decDY': if (dy2 <= 2 * round2) return; dy2--; display(); break;
                case 'win2decDX': if (dx2 <= 2 * round2) return; dx2--; display(); break;
                case 'win2incDX': if (posx2 + dx2 > edx - 2) return; dx2++; display(); break;
                case 'win2incDY': if (posy2 + dy2 > edy - 2) return; dy2++; display(); break;
                case 'win2incR': if (round2 * 2 >= dx2 - 1 || round2 * 2 >= dy2 - 1) return; round2++; display(); break;
                case 'win2decR': if (round2 < 1) return; round2--; display(); break;
                case 'rotateleft90': cropR -= 90; if (cropR < 0) cropR += 360; imgdisplay(); break;
                case 'rotateright90': cropR += 90; if (cropR >= 360) cropR -= 360; imgdisplay(); break;
                case 'cropdecX': if (cropX1 < 1) return; cropX1 --; imgdisplay(); break;
                case 'cropdecY': if (cropY1 < 1) return; cropY1 --; imgdisplay(); break;
                case 'cropincX': if (idx < 9) return; cropX1 ++; imgdisplay(); break;
                case 'cropincY': if (idy < 9) return; cropY1 ++; imgdisplay(); break;
                case 'cropdecDX': if (idx < 9) return; cropX2 ++; imgdisplay(); break;
                case 'cropdecDY': if (idy < 9) return; cropY2 ++; imgdisplay(); break;
                case 'cropincDX': if (cropX2 < 1) return; cropX2 --; imgdisplay(); break;
                case 'cropincDY': if (cropY2 < 1) return; cropY2 --; imgdisplay(); break;
                case 'cropdecR': cropR -= 0.02; if (cropR < 0) cropR += 360; imgdisplay(); break;
                case 'cropincR': cropR += 0.02; if (cropR >= 360) cropR -= 360; imgdisplay(); break;
            }
        }
    }

    setInterval(processKeys, 10)

    function display() {
        let r = Math.round(round * roundQ)
        let r2 = Math.round(round2 * roundQ);
        let img_code = '<path stroke="red" fill="transparent" d="M0 0 v' + edy + ' h' + edx + ' v-' + edy + ' h-' + edx +
            ' M' + (posx + round) + ' ' + posy +
            ' h' + (dx - 2 * round) + ' c' + r + ' 0,' + round + ' ' + (round - r) + ',' + round + ' ' + round +
            ' v' + (dy - 2 * round) + ' c0 ' + r + ',-' + (round - r) + ' ' + round + ',-' + round + ' ' + round +
            ' h-' + (dx - 2 * round) + ' c-' + r + ' 0,-' + round + ' -' + (round - r) + ',-' + round + ' -' + round +
            ' v-' + (dy - 2 * round) + ' c0 -' + r + ',' + (round - r) + ' -' + round + ',' + round + ' -' + round;
        if (window2)
            img_code += ' M' + (posx2 + round2) + ' ' + posy2 +
            ' h' + (dx2 - 2 * round2) + ' c' + r2 + ' 0,' + round2 + ' ' + (round2 - r2) + ',' + round2 + ' ' + round2 +
            ' v' + (dy2 - 2 * round2) + ' c0 ' + r2 + ',-' + (round2 - r2) + ' ' + round2 + ',-' + round2 + ' ' + round2 +
            ' h-' + (dx2 - 2 * round2) + ' c-' + r2 + ' 0,-' + round2 + ' -' + (round2 - r2) + ',-' + round2 + ' -' + round2 +
            ' v-' + (dy2 - 2 * round2) + ' c0 -' + r2 + ',' + (round2 - r2) + ' -' + round2 + ',' + round2 + ' -' + round2;
        img_code += '"/>';
        envelope.innerHTML = img_code;

        let env_code = '[ "Name", ' + eWidth + ', ' + eHeight + ', "' +
            'M' + norm(posx + round) + ' ' + norm(posy) +
            ' h' + norm(dx - 2 * round) + ' c' + norm(r) + ' 0,' + norm(round) + ' ' + norm(round - r) + ',' + norm(round) + ' ' + norm(round) +
            ' v' + norm(dy - 2 * round) + ' c0 ' + norm(r) + ',-' + norm(round - r) + ' ' + norm(round) + ',-' + norm(round) + ' ' + norm(round) +
            ' h-' + norm(dx - 2 * round) + ' c-' + norm(r) + ' 0,-' + norm(round) + ' -' + norm(round - r) + ',-' + norm(round) + ' -' + norm(round) +
            ' v-' + norm(dy - 2 * round) + ' c0 -' + norm(r) + ',' + norm(round - r) + ' -' + norm(round) + ',' + norm(round) + ' -' + norm(round);
        if (window2)
            env_code += ' M' + norm(posx2 + round2) + ' ' + norm(posy2) +
            ' h' + norm(dx2 - 2 * round2) + ' c' + norm(r2) + ' 0,' + norm(round2) + ' ' + norm(round2 - r2) + ',' + norm(round2) + ' ' + norm(round2) +
            ' v' + norm(dy2 - 2 * round2) + ' c0 ' + norm(r2) + ',-' + norm(round2 - r2) + ' ' + norm(round2) + ',-' + norm(round2) + ' ' + norm(round2) +
            ' h-' + norm(dx2 - 2 * round2) + ' c-' + norm(r2) + ' 0,-' + norm(round2) + ' -' + norm(round2 - r2) + ',-' + norm(round2) + ' -' + norm(round2) +
            ' v-' + norm(dy2 - 2 * round2) + ' c0 -' + norm(r2) + ',' + norm(round2 - r2) + ' -' + norm(round2) + ',' + norm(round2) + ' -' + norm(round2);
        env_code += '" ]';
        imgText.innerHTML = env_code;
    }

    function norm(x) {
        return Math.round(x*10000/LEFT_PANEL_WIDTH)/10;
    }

</script>
</body>
</html>